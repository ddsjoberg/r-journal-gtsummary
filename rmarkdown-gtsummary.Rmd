---
title: "gtsummary"
author: "Daniel D. Sjoberg, Karissa Whiting, Margaret Hannum, Emily C. Zabor, Michael Curry"
output:
  pdf_document:
    keep_tex: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
library(gtsummary)
library(tidyverse)
library(gt)

theme_gtsummary_compact()
set_gtsummary_theme(list(
  "as_gt-lst:addl_cmds" = list("cols_hide" = rlang::expr(gt::tab_options(table.font.names = "palatino")))
))
```

# Introduction

# Data Summaries

```{r}
trial %>%
  imap_dfr(
    ~tibble(
      colname = str_glue('`"{.y}"`'), 
      label = attr(.x, "label"), 
      class = class(.x), 
      values = trial %>% select(.y) %>% distinct() %>% 
        arrange(!!rlang::sym(.y)) %>% slice(1:4) %>% pull(.y) %>% 
        na.omit() %>% {paste("`", ., "`", collapse = ", ")}
    ) %>%
      mutate(
        values = ifelse(length(unique(na.omit(trial[[.y]]))) > 4,
                        paste(values, ", ..."),
                        values) 
      )
  ) %>%
  gt() %>%
  fmt_markdown(everything()) %>%
  cols_align("left", everything()) %>%
  as_latex() %>%
  as.character() %>%
  str_replace(fixed("\\toprule"), fixed("\\caption{\\label{tab:}Example data frame, \\texttt{trial}}\\\\\n\\toprule")) %>%
  readr::write_lines("tbl_trial_desc.tex")
```

## `tbl_summary()`

```{r, echo=TRUE}
tbl_summary_1 <-
  trial %>%
  select(age, grade, response, trt) %>%
  tbl_summary(by = trt)
```

```{r, echo=FALSE, include = FALSE}
tbl_summary_1 %>% 
  as_gt() %>%
  gtsave(file = "summary_basic.png")
```

```{r}
tibble::tribble(
  ~Argument,       ~Description,
  "`label`",       "specify the variable labels printed in table",
  "`type`",        "specify the variable type (e.g. continuous, categorical, etc.)",
  "`statistic`",   "change the summary statistics presented",
  "`digits`",      "number of digits the summary statistics will be rounded to",
  "`missing`",     "whether to display a row with the number of missing observations",
  "`missing_text`","text label for the missing number row",
  "`sort`",        "change the sorting of categorical levels by frequency",
  "`percent`",     "print column, row, or cell percentages"
) %>%
  gt() %>%
  fmt_markdown(everything()) %>%
  as_latex() %>%
  as.character() %>%
  str_replace(fixed("\\toprule"), fixed("\\caption{\\label{tab:}\\texttt{tbl\\_summary()} function arguments}\\\\\n\\toprule")) %>%
  readr::write_lines("tbl_tbl_summary_args.tex")

```

```{r, echo=TRUE}
tbl_summary_2 <-
  trial %>%
  select(age, grade, response, trt) %>%
  tbl_summary(by = trt,
              label = age ~ "Patient Age",
              statistic = list(all_continuous() ~ "{mean} ({sd})",
                               all_categorical() ~ "{n} / {N} ({p}%)"),
              digits = list(age ~ 2, 
                            all_categorical() ~ c(0, 0, 1)),
              missing = "no")
```

```{r, echo=FALSE, include = FALSE}
tbl_summary_2 %>% 
  as_gt() %>%
  gtsave(file = "summary_plus.png")
```

```{r}
tibble::tribble(
  ~Function,             ~Description,
  "`add_p()`",           "add p-values to the output comparing values across groups",   
  "`add_overall()`",     "add a column with overall summary statistics",   
  "`add_n()`",           "add a column with N (or N missing) for each variable",
  "`add_difference()`",  "add column for difference between two group, confidemce interval, and p-value",
  "`add_stat_label()`",  "add label for the summary statistics shown in each row",   
  "`add_stat()`",        "generic function to add a column with user-defined values",
  "`add_q()`",           "add a column of q values to control for multiple comparisons"   
)%>%
  gt(caption = "`tbl_summary()` functions to add information") %>%
  fmt_markdown(everything()) %>%
  fmt_markdown(everything()) %>%
  as_latex() %>%
  as.character() %>%
  str_replace(fixed("\\toprule"), fixed("\\caption{\\label{tab:}\\texttt{tbl\\_summary()} functions to add information}\\\\\n\\toprule")) %>%
  readr::write_lines("tbl_tbl_summary_family.tex")
```


\begin{figure}[h!]
  \caption{Simple `tbl\_summary()` example}
  \label{fig:summary_basic}
  \includegraphics[height=5cm]{summary_basic.png}
  \centering
\end{figure}

## `tbl_svysummary()`

## `tbl_cross()`

## `tbl_survfit()`

## Customization

# Model Summaries

## `tbl_regression()`

## `tbl_uvregression()`

# In-line Reporting

# Merging and Stacking

# Themes

# Print Engines
