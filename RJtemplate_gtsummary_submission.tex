% !TeX root = RJwrapper.tex
\title{Reproducible Summary Tables with gtsummary}
\author{by Daniel D. Sjoberg, Karissa Whiting, Margie Hannum, Michael Curry}

\maketitle

\abstract{
An abstract of less than 150 words.
}

\section{Introduction}

\section{Data Summaries}

% adding table describing trial dataset
\input{tbl_trial_desc.tex}


\subsection{\texorpdfstring{\texttt{tbl\_summary()}}{tbl\_summary()}}

% code for basic tbl_summary()
\begin{example}
trial %>%
  select(age, grade, response, trt) %>%
  tbl_summary(by = trt)
\end{example}
\begin{figure}[h!]
  \includegraphics[height=5cm]{summary_basic.png}
  \centering
\end{figure}


% code for tbl_summary() with arguments
\input{tbl_tbl_summary_args.tex}
\begin{example}
trial %>%
  select(age, grade, response, trt) %>%
  tbl_summary(
    by = trt,
    type = all_continuous() ~ "continuous2",
    label = age ~ "Patient Age",
    statistic = list(all_continuous() ~ c("{N_nonmiss}", 
                                          "{mean} ({sd})", 
                                          "{median} ({p25}, {p75})", 
                                          "{min}, {max}"),
                     all_categorical() ~ "{n} / {N} ({p}%)"),
    digits = all_categorical() ~ c(0, 0, 1),
    missing = "no"
  )
\end{example}
\begin{figure}[h!]
  \includegraphics[height=5cm]{summary_plus.png}
  \centering
\end{figure}

% code for tbl_summary() with arguments
\input{tbl_tbl_summary_family.tex}
\begin{example}
trial %>%
  select(age, grade, response, trt) %>%
  tbl_summary(by = trt, missing = "no") %>%
  add_n() %>%
  add_p(test = all_continuous() ~ "t.test",
        pvalue_fun = ~style_pvalue(., digits = 2))

\end{example}
\begin{figure}[h!]
  \includegraphics[height=5cm]{summary_plus_plus.png}
  \centering
\end{figure}

\subsection{\texorpdfstring{\texttt{tbl\_svysummary()}}{tbl\_svysummary()}}

\begin{example}
# create weighted survey object, keep only two counties
data(api, package = "survey")
svy_api <- 
  survey::svydesign(id = ~dnum, weights = ~pw, data = apiclus1, fpc = ~fpc) %>%
  subset(cname %in% c("Alameda", "Los Angeles"))

# summarize data
svy_api %>%
  tbl_svysummary(by = cname, 
                 include = c(growth, target, cname),
                 label = list(growth ~ "Growth",
                              target ~ "Target")) %>%
  add_p()
\end{example}
\begin{figure}[h!]
  \includegraphics[height=4cm]{svysummary.png}
  \centering
\end{figure}

\subsection{\texorpdfstring{\texttt{tbl\_cross()}}{tbl\_cross()}}

\begin{example}
trial %>%
  tbl_cross(row = stage, col = trt, percent = "cell") %>%
  add_p(source_note = TRUE)
\end{example}
\begin{figure}[h!]
  \includegraphics[height=4cm]{cross.png}
  \centering
\end{figure}

\subsection{\texorpdfstring{\texttt{tbl\_survfit()}}{tbl\_survfit()}}

\begin{example}
library(survival)

survfit(Surv(ttdeath, death) ~ trt, trial) %>%
  tbl_survfit(times = c(12, 24),
              label_header = "**{time} Month**") %>%
  add_p()
\end{example}
\begin{figure}[h!]
  \includegraphics[height=4cm]{survfit.png}
  \centering
\end{figure}

\subsection{Customization}

% adding table describing fns for customization
\input{tbl_modify.tex}

\section{Model Summaries}

\subsection{\texorpdfstring{\texttt{tbl\_regression()}}{tbl\_regression()}}

\begin{example}
glm(response ~ age + grade, trial, family = binomial) %>%
  tbl_regression(exponentiate = TRUE) %>%
  add_global_p()
\end{example}

\begin{figure}[h!]
  \includegraphics[height=4cm]{regression.png}
  \centering
\end{figure}

\subsection{\texorpdfstring{\texttt{tbl\_uvregression()}}{tbl\_uvregression()}}
\begin{example}
trial %>%
  select(response, age, grade) %>%
  tbl_uvregression(
    y = response, 
    method = glm,
    method.args = list(family = binomial),
    exponentiate = TRUE,
    pvalue_fun = ~style_pvalue(., digits = 2)
  ) %>%
  add_nevent() %>%
  add_global_p()
\end{example}

\begin{figure}[h!]
  \includegraphics[height=4cm]{uvregression.png}
  \centering
\end{figure}

\hypertarget{in-line-reporting}{%
\section{In-line Reporting}\label{in-line-reporting}}

\hypertarget{merging-and-stacking}{%
\section{Merging and Stacking}\label{merging-and-stacking}}

\hypertarget{themes}{%
\section{Themes}\label{themes}}

\hypertarget{print-engines}{%
\section{Print Engines}\label{print-engines}}

\bibliography{RJreferences}

\address{Author One\\
  Affiliation\\
  Address\\
  Country\\
  (ORCiD if desired)\\
  \email{author1@work}}

\address{Author Two\\
  Affiliation\\
  Address\\
  Country\\
  (ORCiD if desired)\\
  \email{author2@work}}

\address{Author Three\\
  Affiliation\\
  Address\\
  Country\\
  (ORCiD if desired)\\
  \email{author3@work}}
